var Twit,TwitterStrategy,User;Twit=require("twit"),TwitterStrategy=require("passport-twitter").Strategy,User=require("./../models/user.js"),module.exports.configure=function(a){var b,c;return b=a.locals.config,c=a.locals.passport,Twit=new Twit({consumer_key:b.twitter.consumerKey,consumer_secret:b.twitter.consumerSecret,access_token:b.twitter.accessToken,access_token_secret:b.twitter.accessTokenSecret}),c.use(new TwitterStrategy({consumerKey:b.twitter.consumerKey,consumerSecret:b.twitter.consumerSecret,oauthCallbackURL:""+b.oAuthCallbackBaseUrl+"/auth/twitter/callback"},function(a,b,c,d){return User.findOne({twitterId:c.id},function(b,e){return console.log("twitter profile data: ",c),e||(e=new User({twitterId:c.id})),e.name=c.displayName,c.photos&&c.photos[0]&&(e.imageUrl=c.photos[0].value),e.location=c._json.location,e.profileUrl="http://twitter.com/"+c._json.screen_name,e.authenticationToken=a,e.save(function(a,b){return Twit.get("followers/list",{user_id:c.id},function(a,c){var e,f,g,h,i;if(console.log("twitter followers data: ",c),a)return d(a,b.getBasicProfileObject());for(f=[],i=c.users,g=0,h=i.length;h>g;g++)e=i[g],f.push({id:e.id_str,name:e.name,imageUrl:e.profile_image_url,screenName:e.screen_name});return b.twitterFollowers=f,b.save(function(a){return d(a,b.getBasicProfileObject())})})})})}))};