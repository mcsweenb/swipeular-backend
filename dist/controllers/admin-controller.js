var Category,Entity,User,auth,request,_;_=require("underscore"),auth=require("./../lib/auth"),request=require("request"),Category=require("./../models/category"),Entity=require("./../models/entity"),User=require("./../models/user"),module.exports=function(a){var b,c,d,e;return c={},b=a.locals.config,d=a.locals.mongoose,c.signOutAllUsers=function(a,b){return User.update({},{$set:{authenticationToken:null}},{multi:!0}).exec(function(a,c){return console.log("all users signed out, update count:",c),a?b.status(500).send(a):b.status(200).send("All users have been signed out.")})},e={"Beyonce Flaunts New Bob":"slightly unpopular","Edward Snowden":"slightly popular","Guy Fieri":"unpopular","Justin Bieber":"unpopular","Miley Cyrus' VMA Twerk":"unpopular","Rob Ford":"unpopular","Downton Abbey":"slightly popular",Heisenberg:"popular",Girls:"controversial","Macklemore wins 4 Grammys":"slightly popular","The Hunger Games: Catching Fire":"controversial","Sex & the City":"controversial","NFL Super Bowl XLVIII":"slightly popular",Beer:"popular","Doritos Locos Tacos":"controversial","Red Quinoa & Black Bean Salad":"slightly popular","Doughscuit: A glazed Doughnut & Biscuit hybrid":"controversial",'Make a Superbowl "Snackadium"':"slightly unpopular",Cronut:"popular","Cosmic Shower Curtain":"slightly unpopular","Studio Ombre Table Lamp":"slightly popular","Conran Elder Chair":"controversial","Bucky Deer Trophy Head":"controversial","Team USA Sochi 2014 Uniforms":"unpopular","Levi's Classic Camo Windbreaker":"popular","St. John's BayÂ® Button-Front Plaid Poplin Shirt":"popular","Claiborne Cashmere Cable Sweater":"controversial","Dockers Shawl-Collar Cardigan":"controversial","Pepperoni Sweatshirt":"unpopular","St. John's Bay Parka":"slightly popular","Stacy Adams Dumont Mens Cap Toe Lace Up Oxfords":"popular","Stafford Travel Flat-Front Gabardine Trousers":"slightly unpopular","Impressa C5 Dual Espresso Maker":"slightly popular","Lego Kids Star Wars Boba Fett Alarm Clock":"controversial","Nostalgia Electrics Electric Nut Butter Maker":"controversial","Rubik's Cube":"slightly unpopular","Amazon Prime Air":"controversial","iPhone 5s in Gold":"slightly popular","Samsung Galaxy S4":"slightly popular","Chiffon Blouse":"slightly popular","Jeffrey Cambell Quincy Heel":"controversial","Drawstring-Waist Taffeta Skirt":"slightly popular","Skinny Trousers":"slightly popular","Vegan Vest":"controversial"},c.seedOpinions=function(a,b){return User.find({}).exec(function(a,c){return a?b.status(500).send(a):Entity.find({}).exec(function(a,d){var f,g,h,i,j,k,l,m,n,o,p,q;if(a)return b.status(500).send(a);for(l=0,k=0,f=function(){return l>0&&k===l?b.status(200).send("finished seeding opinions"):void 0},g=function(a,b,c){var d,e;return console.log("...creating opinion, entity._id: ",a._id,", user._id: ",b._id,", like: ",c),l++,d={_id:a._id,"opinions.userId":b._id},e={$set:{"opinions.$.like":c}},Entity.update(d,e).exec(function(g,h){return g?(k++,f()):h>0?(Entity.updateLikeCountsForEntityWithId(a._id),k++,f()):(d={_id:a._id},e={$push:{opinions:{userId:b._id,like:c}}},Entity.update(d,e).exec(function(b){return b?(k++,f()):(Entity.updateLikeCountsForEntityWithId(a._id),k++,f())}))})},q=[],o=0,p=d.length;p>o;o++){switch(h=d[o],m=e[h.name]||_.sample(["popular","slightly popular","controversial","slightly unpopular","unpopular"])){case"popular":j=88;break;case"slightly popular":j=70;break;case"controversial":j=50;break;case"slightly unpopular":j=30;break;case"unpopular":j=12}q.push(function(){var a,b,d;for(d=[],a=0,b=c.length;b>a;a++)n=c[a],i=_.random(0,100)<j,d.push(g(h,n,i));return d}())}return q})})},c.seed=function(a,b){var c,d,e;return d=require("./../config/seeds"),c={categories:{truncated:!1,total:d.categories?d.categories.length:0,inserts:0,errors:[]},entities:{truncated:!1,total:d.entities?d.entities.length:0,inserts:0,errors:[]},users:{truncated:!1,total:40,inserts:0,errors:[]}},User.remove({}).exec(function(){var a,b,d,f,g;for(console.log("all users have been removed"),c.users.truncated=!0,console.log("planting new user seeds ("+c.users.total+" in total)..."),g=[],a=d=1,f=c.users.total;f>=1?f>=d:d>=f;a=f>=1?++d:--d)b=new User({email:"yay.or.nay.dummy.user."+a+"@gmail.com",name:"Dummy User "+a,imageUrl:""}),b.generateAndSetAuthenticationToken(),console.log("... saving user "+b.name),g.push(b.save(function(a){return a?(console.log("......error saving user: "+a),c.users.errors.push(a)):c.users.inserts++,e()}));return g}),Category.remove({}).exec(function(){var a,b,f,g,h,i,j;if(console.log("all categories have been removed"),c.categories.truncated=!0,d.categories){for(console.log("planting new category seeds (#{ seeds.categories.length } in total)..."),i=d.categories,j=[],f=g=0,h=i.length;h>g;f=++g)b=i[f],a=new Category(b),console.log("...saving category #"+f+": "+a.name),j.push(a.save(function(a){return a?(console.log("......error saving category: "+a),c.categories.errors.push(a)):c.categories.inserts++,e()}));return j}}),Entity.remove({}).exec(function(){var a,b,f,g,h,i,j;if(console.log("all entities have been removed"),c.entities.truncated=!0,d.entities){for(console.log("planting new entity seeds ("+d.entities.length+" in total)..."),i=d.entities,j=[],f=g=0,h=i.length;h>g;f=++g)b=i[f],a=new Entity(b),console.log("...saving entity #"+f+": "+a.name),_.findWhere(d.categories,{_id:a.category})?j.push(a.save(function(b){return b?(console.log("......error saving entity: "+a.name+" - "+b),c.entities.errors.push(b)):c.entities.inserts++,e()})):(c.entities.errors.push({message:""+a.name+"'s category is not valid"}),j.push(e()));return j}}),e=function(){var a,d,e,f,g,h,i;e="";for(a in c){if(f=c[a],f.inserts+f.errors.length<f.total)return;for(e+="<b>"+a+":</b><br>",f.truncated&&(e+="...successfully truncated<br>"),e+="..."+f.inserts+" created<br>",e+="..."+f.errors.length+" errors<br>",i=f.errors,g=0,h=i.length;h>g;g++)d=i[g],e+="......"+JSON.stringify(d)+"<br>";e+="<br>"}return b.status(200).send(e)}},c};