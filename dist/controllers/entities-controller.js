var Entity,auth,selectQuery;auth=require("./../lib/auth"),Entity=require("./../models/entity"),module.exports=function(a){var b,c;return b={opinions:{}},c=a.locals.mongoose,b.index=function(a,b){var c;return c=Entity.find(),a.query.includeOpinions||c.select("-opinions"),a.query.limit&&c.limit(a.query.limit),c.exec(function(a,c){return a?b.status(500).send(a):b.status(200).send(c)})},b.findByCategory=function(){}},selectQuery={category:category,technology:"technology"},Entity.find(selectQuery).exec(function(a,b){return a?res.status(500).send(a):res.status(200).send(b)}),controller.create=function(a,b){var c;return c=new Entity(a.body),c.save(function(a){return a?b.status(422).send(a):b.status(201).send(c)})},controller.opinions.create=function(a,b){return auth.authenticateRequest(a,b,function(c){var d,e,f;return d=a.params.id,e="true"===a.body.like||a.body.like===!0,d?(selectQuery={_id:d,"opinions.userId":c._id},f={$set:{"opinions.$.like":e}},Entity.update(selectQuery,f).exec(function(a,g){return a?b.status(422).send(a):g>0?(Entity.updateLikeCountsForEntityWithId(d),b.status(204).send()):(selectQuery={_id:d},f={$push:{opinions:{userId:c._id,like:e}}},Entity.update(selectQuery,f).exec(function(a){return a?b.status(422).send(a):(Entity.updateLikeCountsForEntityWithId(d),b.status(201).send())}))})):b.status(422).send({errors:{entityId:"is required"}})})};